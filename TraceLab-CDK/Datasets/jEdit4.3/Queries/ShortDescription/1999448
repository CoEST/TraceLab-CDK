More efficient and general fix for black hole bug